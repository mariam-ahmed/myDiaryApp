rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Default: deny everything
    match /{document=**} {
      allow read, write: if false;
    }

    // Allow users to read/write their own entries
    match /entries/{entryId} {
      allow read, write: if request.auth != null &&
        resource.data.uid == request.auth.uid;
    }

    // Allow therapist to read only if explicitly linked
    match /therapist_links/{linkId} {
      allow read: if request.auth != null &&
        request.auth.token.role == "therapist";
    }
  }
}
